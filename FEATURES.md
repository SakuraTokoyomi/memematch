# MemeMatch 功能说明书

本文档详细说明 MemeMatch 的所有功能和使用方法。

---

## 📋 目录

1. [核心功能](#1-核心功能)
2. [界面说明](#2-界面说明)
3. [使用流程](#3-使用流程)
4. [高级功能](#4-高级功能)
5. [常见场景](#5-常见场景)

---

## 1. 核心功能

### 1.1 智能梗图推荐 ⭐⭐⭐⭐⭐

**功能描述**: 用户输入情绪描述，系统自动推荐最匹配的梗图。

**技术亮点**:
- 🧠 **LLaMA 3.3 70B** 情绪识别
- 🔍 **CLIP + M3E** 多模态检索
- 📊 **Top-2** 推荐算法

**使用方法**:
1. 在输入框输入心情描述（如"我今天太开心了"）
2. 点击发送按钮或按回车
3. 等待1-2秒，查看推理过程
4. 系统返回2张最匹配的梗图

**示例**:
```
输入: "累死了不想上班"
输出:
  - 情绪识别: "累"
  - 推荐图片: [疲惫的表情包1, 疲惫的表情包2]
  - 说明: "找到了一张很适合表达'累'的梗图！"
```

---

### 1.2 创意生成 ⭐⭐⭐⭐

**功能描述**: 基于原始查询和情绪，生成个性化创意梗图。

**技术亮点**:
- ✨ **LLM创意文案生成**（温度0.8，增加创造性）
- 🎲 **随机模板选择**（Drake/Doge/Wojak）
- 🎨 **实时图片生成**

**使用方法**:
1. 在已返回的结果下方，找到 **🎨 创意生成** 按钮
2. 点击按钮
3. 系统生成创意文案并绘制梗图
4. 新梗图显示在对话中

**示例**:
```
原始查询: "我今天太开心了"
情绪关键词: ["开心"]
↓
LLM生成文案: "开心到飞起"
随机模板: doge
↓
输出: [doge表情包 + "开心到飞起"文字]
```

---

### 1.3 流式响应 ⭐⭐⭐⭐⭐

**功能描述**: 实时展示AI推理过程，透明可信。

**技术亮点**:
- 📡 **Server-Sent Events (SSE)** 流式传输
- ⚡ **实时更新**（无需等待全部完成）
- 🔍 **推理过程可视化**

**展示内容**:
```
💭 思考过程
1. 💡 情绪识别：开心
2. 🔍 梗图检索：找到匹配"开心"的图片（相似度 85%）
```

**状态说明**:
- ⏳ **running**: 正在执行
- ✅ **success**: 执行成功
- ⚠️ **low_score**: 分数不足
- ❌ **failed**: 执行失败

---

### 1.4 Top-N 推荐 ⭐⭐⭐⭐

**功能描述**: 返回多张候选图片，增加用户选择空间。

**技术亮点**:
- 📊 **Top-2策略**（平衡质量和多样性）
- 🎯 **分数阈值0.8**（保证推荐质量）
- 🖼️ **响应式网格布局**

**界面展示**:

**单张图片**:
```
┌─────────────────┐
│                 │
│    图片1        │
│  (居中显示)      │
│                 │
└─────────────────┘
```

**多张图片**:
```
┌──────────┐ ┌──────────┐
│  ①      │ │  ②      │
│ 图片1    │ │ 图片2    │
│          │ │          │
└──────────┘ └──────────┘
```

---

### 1.5 会话管理 ⭐⭐⭐

**功能描述**: 保存对话历史，支持多轮对话。

**技术亮点**:
- 💾 **localStorage持久化**
- 🔄 **自动恢复**（刷新页面后）
- 🗑️ **一键清空**

**使用方法**:
1. 系统自动创建会话ID
2. 对话历史自动保存在浏览器
3. 点击"清空会话"删除历史

**会话信息**:
- 会话ID
- 消息数量
- 查询次数
- 创建时间
- 最后活跃时间

---

## 2. 界面说明

### 2.1 主界面布局

```
┌─────────────────────────────────────┐
│          MemeMatch 🎭               │  ← 标题
├─────────────────────────────────────┤
│                                     │
│  示例: 我今天太开心了                 │  ← 示例查询
│                                     │
├─────────────────────────────────────┤
│                                     │
│  [对话区域]                          │  ← 消息展示
│    - 用户消息                         │
│    - AI回复                          │
│    - 推理过程                         │
│    - 梗图展示                         │
│                                     │
├─────────────────────────────────────┤
│  [输入你的心情...]  [📤]             │  ← 输入框
└─────────────────────────────────────┘
```

### 2.2 消息类型

#### 用户消息
```
┌─────────────────────────┐
│ 👤 用户                  │
│ ┌─────────────────────┐ │
│ │ 我今天太开心了      │ │
│ └─────────────────────┘ │
│         14:32           │
└─────────────────────────┘
```

#### AI回复（推理过程）
```
┌─────────────────────────┐
│ 🤖 AI助手                │
│ ┌─────────────────────┐ │
│ │ 💭 思考过程          │ │
│ │ 1. 💡 情绪识别: 开心 │ │
│ │ 2. 🔍 梗图检索: 成功 │ │
│ └─────────────────────┘ │
└─────────────────────────┘
```

#### AI回复（梗图展示）
```
┌─────────────────────────┐
│ 🤖 AI助手                │
│ ┌─────────────────────┐ │
│ │ [图片1]  [图片2]    │ │
│ │                     │ │
│ │ 找到符合您情绪的梗图 │ │
│ │                     │ │
│ │ 📚检索 共2张         │ │
│ │        [🎨创意生成]  │ │
│ └─────────────────────┘ │
│         14:32           │
└─────────────────────────┘
```

---

## 3. 使用流程

### 3.1 基础流程

```
开始
  ↓
打开 http://localhost:3000
  ↓
输入情绪描述
  ↓
点击发送 / 按回车
  ↓
查看推理过程
  ↓
获得梗图推荐
  ↓
[可选] 点击"创意生成"
  ↓
结束
```

### 3.2 详细步骤

#### 步骤1: 访问应用
在浏览器打开 `http://localhost:3000`

#### 步骤2: 输入描述
在输入框输入你的心情，例如：
- "我今天太开心了"
- "累死了不想上班"
- "无语了这也行"

#### 步骤3: 查看推理
系统实时展示推理过程：
```
💭 思考过程
1. 💡 情绪识别：开心
   ✅ 提取关键词成功
2. 🔍 梗图检索：找到匹配"开心"的图片
   ✅ 相似度 85%，找到 2 张
```

#### 步骤4: 查看结果
系统返回2张梗图：
- 图片网格展示
- 推荐理由说明
- 来源标识（检索/生成）

#### 步骤5: 创意生成（可选）
如果想要更个性化的梗图：
1. 点击 **🎨 创意生成** 按钮
2. 等待1-2秒
3. 获得创意梗图

---

## 4. 高级功能

### 4.1 查询融合策略

**问题**: 如何提高检索准确率？

**方案**: 融合原始查询和情绪关键词

**逻辑**:
```python
if len(user_input) > len(keywords[0]) * 2:
    query = f"{user_input} {keywords[0]}"  # 保留完整语义
else:
    query = keywords[0]  # 直接使用关键词
```

**示例**:
```
输入: "我今天工作很顺利，老板还夸奖了我"
关键词: ["顺利", "开心"]
融合查询: "我今天工作很顺利，老板还夸奖了我 顺利"

输入: "开心"
关键词: ["开心"]
融合查询: "开心"  （直接使用）
```

**优势**:
- 保留完整语义信息
- 增强情绪焦点
- 提高检索准确率

---

### 4.2 分数阈值策略

**问题**: 何时使用检索结果，何时生成？

**方案**: 设置分数阈值 0.8

**逻辑**:
```python
SCORE_THRESHOLD = 0.8

if top_result['score'] >= SCORE_THRESHOLD:
    return search_results  # 使用检索结果
else:
    return generate_meme()  # 降级到生成
```

**阈值选择依据**:
- < 0.7: 匹配度较低，体验差
- 0.7-0.8: 可接受但不理想
- 0.8-0.9: 良好匹配
- > 0.9: 优秀匹配

---

### 4.3 模板随机化

**问题**: 如何增加创意生成的多样性？

**方案**: 随机选择模板

**模板列表**:
1. **Drake**: 上下对比式
   ```
   [Drake嫌弃的表情]  ← 负面
   [Drake满意的表情]  ← 正面（文案）
   ```

2. **Doge**: 经典柴犬
   ```
   [Doge表情]
   [文案在左上角]
   ```

3. **Wojak**: 情绪表达
   ```
   [Wojak表情]
   [文案在底部]
   ```

**随机逻辑**:
```python
template = random.choice(['drake', 'doge', 'wojak'])
```

---

## 5. 常见场景

### 场景1: 工作压力

**输入**: "项目延期了，压力好大"

**系统处理**:
1. 情绪识别: `["压力"]`
2. 检索匹配度: 82%
3. 返回2张"压力"主题梗图

**预期效果**: 用户看到共鸣的表情包，释放压力

---

### 场景2: 好事分享

**输入**: "我今天升职加薪了，太开心了！"

**系统处理**:
1. 情绪识别: `["开心", "喜悦"]`
2. 检索匹配度: 88%
3. 返回2张"开心"主题梗图

**预期效果**: 用户找到合适的图片分享喜悦

---

### 场景3: 无奈吐槽

**输入**: "我服了，这也行？"

**系统处理**:
1. 情绪识别: `["服了", "无奈"]`
2. 检索匹配度: 76% (< 0.8)
3. 触发生成器
4. LLM文案: "我也是醉了"
5. 随机模板: Wojak
6. 返回生成的梗图

**预期效果**: 获得个性化的吐槽表情包

---

### 场景4: 二次创作

**步骤1**: 搜索"我今天太开心了"
- 获得2张检索结果

**步骤2**: 点击"🎨 创意生成"
- 系统生成创意文案: "开心到飞起"
- 随机模板: Doge
- 获得创意梗图

**预期效果**: 在原有推荐基础上，获得更个性化的版本

---

## 💡 使用技巧

### 技巧1: 简洁输入
- ✅ 好: "我今天太开心了"
- ❌ 差: "我今天心情非常非常非常好，超级开心的那种，就是..."

**原因**: 简洁输入更容易提取核心情绪

---

### 技巧2: 明确情绪
- ✅ 好: "累死了"、"开心"、"无语"
- ❌ 差: "今天感觉怪怪的"、"说不出来的感觉"

**原因**: 明确的情绪词更容易匹配

---

### 技巧3: 善用创意生成
- 如果检索结果不满意，尝试"创意生成"
- 多点几次可能获得不同风格的梗图

---

### 技巧4: 保存喜欢的图片
- 右键点击图片 → "图片另存为"
- 或直接拖拽到桌面

---

## 📊 功能对比

| 功能 | 检索推荐 | 创意生成 |
|------|----------|----------|
| 速度 | 快 (1-2s) | 中等 (1-2s) |
| 质量 | 高 (真实梗图) | 中 (生成图片) |
| 多样性 | 低 (数据集限制) | 高 (无限可能) |
| 适用场景 | 常见情绪 | 特殊情绪 |

---

## 🎯 最佳实践

### 1. 首次使用
建议先尝试示例查询，了解系统能力

### 2. 日常使用
- 快速输入情绪，获取推荐
- 不满意时使用"创意生成"

### 3. 批量获取
- 多次查询相同情绪，获得不同结果
- 点击"创意生成"获取更多样化的图片

---

## 📞 反馈与建议

如果您有任何问题或建议，请：
- 提交 [GitHub Issue](https://github.com/your-org/memematch/issues)
- 发送邮件至 contact@memematch.com

---

**最后更新**: 2025-11-22  
**版本**: v2.0.0

