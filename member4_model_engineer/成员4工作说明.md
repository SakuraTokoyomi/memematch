# 成员4：模型工程师 - 工作说明书

## 📋 角色定位

您是 **MemeMatch** 项目的**模型工程师**，负责项目的核心技术模块——文本表示模型。

---

## 🎯 您要做什么？

### 核心任务（必须完成）

#### 1. 句向量模型选型与评估
**目标**：找出最适合"聊天句子→表情包"语义匹配的预训练模型

**具体工作**：
- 评估3-5个候选句向量模型（已在 `config/models.yaml` 中配置好）
- 在测试集上计算 Recall@1/3/5、MRR 等指标
- 对比模型性能（准确率 vs 速度）
- 选出最佳模型

**时间**：Day 5-6（收到数据后）

#### 2. 向量导出
**目标**：将所有表情包描述编码为向量，供检索系统使用

**具体工作**：
- 使用最佳模型编码所有表情包
- 导出向量文件（NumPy格式）
- 导出ID映射文件（JSON格式）
- 生成元数据和使用文档

**时间**：Day 7

#### 3. 协作交付
**目标**：将成果交付给其他团队成员

**具体工作**：
- 向量文件 → 成员3（检索系统工程师）
- 评估结果 → 成员1（项目负责人）
- 推理接口 → 成员5（部署工程师）

**时间**：Day 7-8

### 可选任务（加分项）

#### 4. 对比学习微调（如果时间允许）
- 在配对数据上进行轻量微调
- 对比零样本 vs 微调性能
- 提供消融实验

**时间**：Week 2

---

## 🛠️ 怎么做？

### 阶段0：环境准备（今天，30分钟）

```bash
# 1. 进入项目目录
cd member4_model_engineer

# 2. 创建虚拟环境
python -m venv venv
source venv/bin/activate  # macOS/Linux

# 3. 安装依赖
pip install -r requirements.txt

# 4. 测试环境
python test_setup.py
# 看到 "✅ 环境配置正常！" 即可
```

### 阶段1：数据准备（Day 2-4，等待成员2）

**等待成员2提供以下数据**：
- `data/memes.json` - 150-200个表情包（含标签、关键词）
- `data/queries_test.json` - 100-160条测试查询句子
- `data/ground_truth.json` - 标注的正确答案

**收到数据后，立即验证**：
```bash
# 快速检查
python -c "
import json
memes = json.load(open('data/memes.json'))
print(f'表情包数量: {len(memes)}')
queries = json.load(open('data/queries_test.json'))
print(f'测试句子数量: {len(queries[\"test\"])}')
"
```

### 阶段2：模型评估（Day 5-6，10-30分钟）

```bash
# 运行模型对比脚本
python scripts/01_compare_models.py

# 查看结果
cat outputs/model_comparison.csv
cat outputs/evaluation_report.txt
```

**输出结果示例**：
```
模型                                    Recall@1  Recall@3  Recall@5  MRR    速度
paraphrase-multilingual-MiniLM-L12-v2   0.45     0.67      0.78     0.56   25 句/秒
shibing624/text2vec-base-chinese        0.48     0.71      0.82     0.59   18 句/秒
```

**选择标准**：
- 优先看 **Recall@3**（最重要！目标 ≥ 0.55）
- 兼顾速度（目标 > 10句/秒）
- 多语言场景优先选多语言模型

### 阶段3：向量导出（Day 7，5分钟）

```bash
# 使用最佳模型导出向量
python scripts/02_export_embeddings.py \
  --model paraphrase-multilingual-MiniLM-L12-v2 \
  --meme-file memes.json \
  --output-dir outputs
```

**输出文件**（在 `outputs/` 目录）：
- `meme_embeddings.npy` - 向量数据（N×D的矩阵）
- `meme_ids.json` - 表情包ID列表
- `meme_texts.txt` - 描述文本（调试用）
- `metadata.json` - 元数据（包含使用说明）

**验证输出**：
```bash
python -c "
import numpy as np
embeddings = np.load('outputs/meme_embeddings.npy')
print(f'向量形状: {embeddings.shape}')
print(f'向量类型: {embeddings.dtype}')
print(f'向量范围: [{embeddings.min():.3f}, {embeddings.max():.3f}]')
"
```

### 阶段4：交付成果（Day 7-8）

#### 交付给成员3（检索系统）

```bash
# 打包文件
cd outputs
zip member4_to_member3.zip \
  meme_embeddings.npy \
  meme_ids.json \
  metadata.json

# 通知成员3
```

**提供信息**：
- 向量维度：XXX
- 表情包数量：XXX
- 使用方法：见 metadata.json

#### 交付给成员1（项目负责人）

提交以下文件：
1. `outputs/model_comparison.csv` - 模型对比表
2. `outputs/evaluation_report.txt` - 详细报告
3. **1页模型选型报告**（需要自己撰写）

**选型报告模板**：
```markdown
# 模型选型报告

## 1. 评估概述
- 评估模型数：4个
- 数据规模：XXX条查询 × XXX个表情包
- 关键指标：Recall@3

## 2. 结果对比
[插入表格]

## 3. 推荐模型
- **选择**：paraphrase-multilingual-MiniLM-L12-v2
- **理由**：
  - Recall@3达到0.67，超过目标0.55
  - 支持中英混合输入
  - 速度快（25句/秒），适合实时推理
  - 轻量模型（118M参数），CPU友好

## 4. 存在问题与改进方向
- 问题：小数据集，泛化能力有限
- 改进：增加数据、微调、数据增强
```

#### 交付给成员5（部署）

提供推理接口代码（已包含在 `COLLABORATION.md` 中）

---

## 📊 成功标准

### 必须达到（80分）
- ✅ 评估至少3个模型
- ✅ Recall@3 ≥ 0.55
- ✅ 导出正确的向量文件
- ✅ 向量文件可被成员3正常使用
- ✅ 提供完整文档

### 优秀标准（100分）
- 🌟 评估5个模型
- 🌟 Recall@3 ≥ 0.65
- 🌟 包含详细误差分析
- 🌟 提供微调版本对比

---

## 📂 文件导航

**按优先级阅读**：

1. **START_HERE.md** ⭐⭐⭐ - 最快上手
2. **本文档**（成员4工作说明.md）⭐⭐⭐ - 完整工作方案
3. **QUICKSTART.md** ⭐⭐ - 详细操作步骤
4. **COLLABORATION.md** ⭐⭐ - 协作接口
5. **README.md** ⭐ - 技术文档
6. **data/README.md** ⭐ - 数据格式

---

## ⏰ 时间规划

| 阶段 | 任务 | 预计时间 | 依赖 |
|------|------|----------|------|
| Day 1 | 环境搭建 | 30分钟 | - |
| Day 2-3 | 等待数据 | - | 成员2 |
| Day 4 | 数据验收 | 30分钟 | 成员2 |
| Day 5-6 | 模型评估 | 10-30分钟 | - |
| Day 6 | 撰写报告 | 1-2小时 | - |
| Day 7 | 向量导出 | 5分钟 | - |
| Day 7-8 | 协作交付 | 1小时 | 成员3/5 |

**总工作量**：约4-6小时（不含等待时间）

---

## 🤝 协作关系

```
成员2 ──[数据]──> 成员4（你） ──[向量]──> 成员3
                    │
                    └──[结果]──> 成员1
                    │
                    └──[接口]──> 成员5
```

---

## ❓ FAQ

### Q1: 我需要懂深度学习吗？
**A**: 不需要！所有代码都已经写好，您只需运行脚本、查看结果、做决策。

### Q2: 如果数据还没准备好？
**A**: 使用 `data/memes_sample.json` 测试流程，熟悉代码。

### Q3: 模型下载需要多久？
**A**: 首次运行会自动下载，约5-10分钟（取决于网络）。可以设置镜像加速：
```bash
export HF_ENDPOINT=https://hf-mirror.com
```

### Q4: 向量文件很大吗？
**A**: 不大。200个表情包 × 384维 × 4字节 ≈ 300KB。

### Q5: 如果评估结果不达标？
**A**: 
1. 检查数据质量（是否标注准确）
2. 尝试其他模型
3. 调整表情包描述（优化关键词）
4. 如果实在不行，记录问题，说明是数据限制

---

## 🎓 技术补充

### 核心技术栈
- **sentence-transformers**：句向量模型库
- **scikit-learn**：相似度计算
- **numpy**：向量存储
- **pandas**：结果分析

### 关键概念
- **句向量（Sentence Embedding）**：文本→固定维度向量
- **余弦相似度（Cosine Similarity）**：衡量向量相似度，范围[-1, 1]
- **Recall@k**：Top-k预测中命中正确答案的比例
- **MRR**：第一个正确答案的平均排名倒数

---

## 📞 需要帮助

- **环境问题**：查看 `test_setup.py` 的输出
- **代码问题**：查看 `src/` 中的注释
- **数据问题**：联系成员2，参考 `data/README.md`
- **集成问题**：联系成员3/5，参考 `COLLABORATION.md`

---

## ✅ 检查清单

**开始前**：
- [ ] 阅读本文档
- [ ] 环境安装完成
- [ ] `python test_setup.py` 通过

**数据就绪后**：
- [ ] 验证数据格式
- [ ] 运行模型评估
- [ ] 选出最佳模型
- [ ] 导出向量

**交付前**：
- [ ] 向量文件验证通过
- [ ] 评估报告撰写完成
- [ ] 通知相关成员
- [ ] 文档完整

---

## 🚀 立即开始

```bash
cd member4_model_engineer
python test_setup.py
```

**祝工作顺利！** 🎉


