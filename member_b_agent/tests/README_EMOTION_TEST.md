# 情绪识别测试工具

## 📝 简介

这是一个独立的测试工具，用于评估LLM（Meta-Llama-3.3-70B-Instruct）从用户输入中提取情绪词的能力。

## 🎯 测试目的

- 评估LLM的情绪识别准确率
- 发现模型的弱点（容易被干扰的场景）
- 为Prompt优化提供数据支持
- 测试不同温度参数的影响

## 🚀 使用方法

### 1. 完整测试套件

运行所有测试用例（8个类别，40+个测试）：

```bash
cd member_b_agent/tests
python test_emotion_extraction.py
```

### 2. 单个输入测试

测试单个句子的情绪提取：

```bash
python test_emotion_extraction.py --single "我今天好开心"
```

### 3. 温度对比测试

测试不同温度参数对结果的影响：

```bash
python test_emotion_extraction.py --temp-test
```

## 📊 测试类别

### 类别1：简单情绪
直接的情绪词，如"开心"、"累"、"无语"

### 类别2：修饰情绪
带修饰词的情绪，如"今天好开心"、"我太累了"

### 类别3：复杂句子
包含动作词，如"我想分享这份喜悦"

### 类别4：长句干扰
长句子容易干扰LLM，如"我今天工作很顺利，老板还夸奖了我，想分享这份喜悦"

### 类别5：隐含情绪
需要推理的情绪，如"项目又延期了" → "无奈"

### 类别6：网络用语
口语化表达，如"我真的会谢" → "无语"

### 类别7：多情绪混合
多个情绪，如"既开心又紧张"

### 类别8：误导测试
边界情况，测试模型的判断

## 📈 输出示例

```
================================================================================
🧪 情绪识别能力测试
📊 模型: Meta-Llama-3.3-70B-Instruct
🌡️  温度: 0.1
================================================================================

📂 类别: 简单情绪
--------------------------------------------------------------------------------
✅ 输入: 开心                        | 预期: 开心     | 实际: 开心
✅ 输入: 累                          | 预期: 累       | 实际: 累
✅ 输入: 无语                        | 预期: 无语     | 实际: 无语
   📊 类别准确率: 3/3 (100.0%)

📂 类别: 复杂句子
--------------------------------------------------------------------------------
❌ 输入: 我想分享这份喜悦             | 预期: 喜悦     | 实际: 分享
✅ 输入: 想表达一下开心的心情         | 预期: 开心     | 实际: 开心
   📊 类别准确率: 1/2 (50.0%)

================================================================================
📊 总体统计
================================================================================
✅ 正确: 35/40
❌ 错误: 5/40
📈 准确率: 87.50%

🥈 评级: 良好 - LLM情绪识别基本准确
================================================================================
```

## 🎯 评分标准

| 准确率 | 评级 | 说明 |
|--------|------|------|
| ≥ 90% | 🏆 优秀 | LLM情绪识别能力很强 |
| 80-89% | 🥈 良好 | 基本准确，可用于生产 |
| 70-79% | 🥉 中等 | 有待提升，需要优化Prompt |
| < 70% | ⚠️ 较差 | 建议换模型或重新设计 |

## 🔧 Prompt设计

当前使用的情绪提取Prompt：

```python
EMOTION_EXTRACTION_PROMPT = """你是情绪识别专家。从用户输入中提取核心情绪词。

规则：
1. 只提取情绪或状态词（开心、难过、累、压力、无奈等）
2. 忽略动作词（想、要、分享、表达、希望等）
3. 忽略对象词（老板、项目、考试等）
4. 只输出1-2个字的情绪词，不要解释

示例：
用户："我今天好开心" → 输出：开心
用户："我想分享这份喜悦" → 输出：喜悦
用户："项目延期了压力好大" → 输出：压力
"""
```

## 📝 添加测试用例

在 `TEST_CASES` 中添加新的测试：

```python
{
    "category": "你的类别",
    "cases": [
        {"input": "用户输入", "expected": "预期情绪词"},
        {"input": "另一个输入", "expected": "预期情绪词"},
    ]
}
```

## 🌡️ 温度参数影响

温度越低，输出越稳定：

| 温度 | 特点 | 适用场景 |
|------|------|---------|
| 0.0 | 完全确定性 | 情绪提取（推荐） |
| 0.1 | 高度稳定 | 情绪提取（推荐） |
| 0.3 | 稍有变化 | 需要一定灵活性 |
| 0.5 | 中等随机 | 创意生成 |
| 0.7+ | 高度随机 | 不推荐用于提取 |

## 🐛 常见问题

### Q: 准确率低怎么办？

**A:** 
1. 检查是否是Prompt设计问题
2. 尝试降低温度（0.1或0.0）
3. 增加更多示例到Prompt中
4. 考虑换用更强的模型

### Q: LLM总是提取错误的词

**A:**
1. 在Prompt中添加"❌ 错误示例"
2. 强化"忽略动作词"的规则
3. 提供对照表格

### Q: 如何测试新的Prompt？

**A:**
1. 修改 `EMOTION_EXTRACTION_PROMPT` 变量
2. 运行测试：`python test_emotion_extraction.py`
3. 对比准确率变化

## 📊 优化建议

根据测试结果：

1. **准确率 < 80%**
   - 重点优化Prompt
   - 添加更多正反示例
   - 考虑使用Few-shot learning

2. **特定类别准确率低**
   - 针对该类别增加示例
   - 在Prompt中强调该场景

3. **长句识别差**
   - 强调"忽略句子结构"
   - 提供复杂句子示例

## 🔗 相关文件

- `test_emotion_extraction.py` - 测试脚本
- `../agent/agent_core.py` - Agent的完整Prompt
- `../agent/config.py` - 模型配置

## 📈 持续改进

1. 定期运行测试（每次改Prompt后）
2. 记录准确率变化
3. 收集真实失败案例
4. 不断优化测试集

---

**建议：每次修改Agent的System Prompt后，先运行这个测试，确保情绪识别准确率没有下降！** ✅

